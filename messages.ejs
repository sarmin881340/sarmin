<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>ржорзЗрж╕рзЗржЬрж┐ржВ рж╕рж┐рж╕рзНржЯрзЗржо</title>
<link rel="stylesheet" href="/style.css">
</head>
<body>
<div class="container" style="max-width: 90vw; text-align: left;">
    <h2 style="text-align: center; color: #17a2b8;">ЁЯТм ржорзЗрж╕рзЗржЬрж┐ржВ рж╕рж┐рж╕рзНржЯрзЗржо</h2>
    
    <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center;">
        <p><strong>ржЖржкржирж╛рж░ ржЗржЙржЬрж╛рж░ ржЖржЗржбрж┐:</strong> 
        <span style="background: #ffffff; padding: 8px 15px; border-radius: 5px; font-weight: bold; color: #17a2b8;">
            <%= user.userId %>
        </span></p>
    </div>

    <!-- ржЗржЙржЬрж╛рж░ рж╕рж╛рж░рзНржЪ ржлрж░рзНржо -->
    <div style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin: 20px 0;">
        <h3 style="color: #17a2b8; margin-bottom: 15px;">ржЗржЙржЬрж╛рж░ ржЦрзБржБржЬрзБржи</h3>
        <form method="POST" action="/search_user">
            <input type="text" name="searchUserId" placeholder="ржЗржЙржЬрж╛рж░ ржЖржЗржбрж┐ рж▓рж┐ржЦрзБржи (ржпрзЗржоржи: U123456001)" required 
                   style="width: 70%; margin-right: 10px;">
            <button type="submit" class="btn" style="width: 25%; padding: 15px; font-size: 16px;">
                ЁЯФН ржЦрзБржБржЬрзБржи
            </button>
        </form>
        
        <% if (typeof error !== 'undefined' && error) { %>
            <div class="error" style="margin-top: 15px;"><%= error %></div>
        <% } %>
    </div>

    <!-- ржЗржЙржЬрж╛рж░ ржкрж╛ржУржпрж╝рж╛ ржЧрзЗрж▓рзЗ ржЪрзНржпрж╛ржЯ рж╕рзЗржХрж╢ржи -->
    <% if (typeof foundUser !== 'undefined' && foundUser) { %>
    <div style="background: #ffffff; border: 2px solid #17a2b8; border-radius: 15px; padding: 25px; margin: 20px 0;">
        <h3 style="color: #17a2b8; text-align: center; margin-bottom: 20px;">
            ЁЯТм <%= foundUser.name %> ржПрж░ рж╕рж╛ржерзЗ ржЪрзНржпрж╛ржЯ (ID: <%= foundUser.userId %>)
        </h3>
        
        <!-- ржорзЗрж╕рзЗржЬ рж╣рж┐рж╕рзНржЯрзНрж░рж┐ -->
        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; max-height: 400px; overflow-y: auto; margin-bottom: 20px;">
            <% if (messages.length === 0) { %>
                <p style="text-align: center; color: #666;">ржПржЦржирзЛ ржХрзЛржирзЛ ржорзЗрж╕рзЗржЬ ржирзЗржЗред ржкрзНрж░ржержо ржорзЗрж╕рзЗржЬ ржкрж╛ржарж╛ржи!</p>
            <% } else { %>
                <% messages.forEach(msg => { %>
                    <% const sender = users.find(u => u.id === msg.senderId) %>
                    <div style="margin: 10px 0; padding: 12px; border-radius: 8px; 
                                <%= msg.senderId === user.id ? 'background: #e3f2fd; margin-left: 50px; text-align: right;' : 'background: #fff3cd; margin-right: 50px;' %>">
                        <p style="margin: 0; font-weight: bold; color: #17a2b8;">
                            <%= msg.senderId === user.id ? 'ржЖржкржирж┐' : sender.name %>
                        </p>
                        <p style="margin: 8px 0 4px 0;"><%= msg.messageText %></p>
                        <small style="color: #666;">
                            <%= new Date(msg.sentAt).toLocaleString('bn-BD') %>
                        </small>
                    </div>
                <% }) %>
            <% } %>
        </div>
        
        <!-- ржирждрзБржи ржорзЗрж╕рзЗржЬ ржкрж╛ржарж╛ржирзЛ -->
        <form method="POST" action="/send_message">
            <input type="hidden" name="receiverId" value="<%= foundUser.id %>">
            <div style="display: flex; gap: 10px;">
                <textarea name="messageText" placeholder="ржЖржкржирж╛рж░ ржорзЗрж╕рзЗржЬ рж▓рж┐ржЦрзБржи..." 
                          required rows="3" style="flex: 1; resize: vertical;"></textarea>
                <button type="submit" class="btn" style="width: 120px; height: fit-content;">
                    ЁЯУд ржкрж╛ржарж╛ржи
                </button>
            </div>
        </form>
    </div>
    <% } %>

    <div style="text-align: center; margin-top: 30px;">
        <a href="/dashboard" class="btn btn-secondary">ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржбрзЗ ржлрж┐рж░рзЗ ржпрж╛ржи</a>
    </div>
</div>
</body>
</html>